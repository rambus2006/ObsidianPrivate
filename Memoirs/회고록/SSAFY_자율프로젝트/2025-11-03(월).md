**âœ… KEEP**

- ì˜¤ëŠ˜ ì˜í•œ ì , ê³„ì† ìœ ì§€í•˜ê³  ì‹¶ì€ ê²ƒ
    
    - ex) ì•„ì¹¨ íšŒì˜ ë•Œ ì „ë‚  ì´ìŠˆë¥¼ ë¯¸ë¦¬ ì •ë¦¬í•´ ê³µìœ í–ˆë‹¤
    - ex) Docker Compose ì„¤ì •ì„ íŒ€ì›ê³¼ ë¹ ë¥´ê²Œ ê³µìœ í•´ ë¹Œë“œ ì†ë„ ë‹¨ì¶•

| ì‘ì„±ì | ë‚´ìš©                                                                                                                                                             |
| --- | -------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ë°©ë¯¼ì„œ | - í™ˆí™”ë©´ í´ë” ìƒì„± ì˜¤ë¥˜ í•´ê²° <br>- í™ˆí™”ë©´ í´ë” ì´ë™ <br>- ë²„íŠ¼ìœ¼ë¡œ ë§Œë“¤ê¸° <br>- ë”ë¯¸ë°ì´í„° ë„£ê¸° <br>- í´ë”ì™€ íŒŒì¼ ì‚­ì œ:íŒŒì¼ ì‚­ì œ api ê°€ ì¡´ì¬í•˜ì§€ ì•Šì•„ í´ë” ì‚­ì œ ìš°ì„ ì ìœ¼ë¡œ êµ¬í˜„ <br>- í´ë”ì™€ íŒŒì¼ ì´ë¦„ ìˆ˜ì •<br>- í´ë” êµ¬ì¡° ì´ë™ ê¸°ëŠ¥ êµ¬í˜„ <br> |

---

**âš ï¸ PROBLEM**

- ì˜¤ëŠ˜ ì•„ì‰¬ìš´ ì , ê°œì„ ì´ í•„ìš”í•œ ê²ƒ
    - ex) ë¦¬ë·° ì½”ë“œ ë¨¸ì§€ íƒ€ì´ë°ì´ ëŠ¦ì–´ ë¹Œë“œê°€ ì§€ì—°ë¨
    - ex) TMDB API í…ŒìŠ¤íŠ¸ ì‹œ ì—ëŸ¬ í•¸ë“¤ë§ ë¡œì§ì´ ë¯¸í¡

| ì‘ì„±ì | ë‚´ìš©                                    |
| --- | ------------------------------------- |
| ë°©ë¯¼ì„œ | í´ë” ë“œë˜ê·¸ë¥¼ í†µí•œ êµ¬ì¡° ë³€ê²½ì„ í•˜ëŠ”ë° 4ì‹œê°„ì´ ê±¸ë ¤ì„œ ì•„ì‰¬ì› ë‹¤.  |


---

**ğŸ’¡ TRY**

- ë‚´ì¼ ì‹œë„í•˜ê±°ë‚˜ ê°œì„ í•  ë°©ë²•
    - ex) PR ì˜¬ë¦¬ê¸° ì „ ë¡œì»¬ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ìë™í™”
    - ex) ë§¤ì¼ ì˜¤ì „ 10ì‹œ ì „ íŒ€ ì „ì²´ ë¹Œë“œ ì ê²€ ì•Œë¦¼ ì„¤ì •

| ì‘ì„±ì | ë‚´ìš©                                                                 |
| --- | ------------------------------------------------------------------ |
| ë°©ë¯¼ì„œ | ì»¤ì„œí•œí…Œ ë„ˆë¬´ ë‹¤ í•´ë‹¬ë¼ëŠ” ê²ƒ ê°™ë‹¤. ë‚´ì¼ì€ íŒŒì¼ ì²´í¬ë°•ìŠ¤ë‚˜ ë“œë˜ê·¸ë¡œ í•œë²ˆì— ì´ë™í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë´ì•¼ í•  ê²ƒ ê°™ë‹¤.   |


---

**ğŸ“ ë©”ëª¨ & ê¸°íƒ€**

- ììœ  ë©”ëª¨: ëŠë‚€ ì , ë‚´ì¼ ì¼ì •, ì¶”ê°€ ì•„ì´ë””ì–´ ë“±

| ì‘ì„±ì | ë‚´ìš©  |
| --- | --- |
| ë°©ë¯¼ì„œ |     |

**ğŸ“ í•´ê²°í•œ ì—ëŸ¬**
##### ì—ëŸ¬ 1)
 1. ì—ëŸ¬ ë‚œ ë¶€ë¶„ & ê¸°ëŠ¥ 
[íŒŒì¼ ì‹œìŠ¤í…œ UI/UXêµ¬í˜„] 
Feat(S13P31S103-48-ui-ux) : [FE] FIleSystem UIUX

 2. ì—ëŸ¬ ë©”ì‹œì§€ 
```
ì—ëŸ¬: Request failed with status code 403
```
3. ë¬¸ì œ ì‹œë‚˜ë¦¬ì˜¤:
   - ë£¨íŠ¸ í´ë” ìƒì„± ì‹œ (`parentId = null`):
     - `canEdit(null, userId)` í˜¸ì¶œ
     - `isOwner(null, userId)`ëŠ” í•­ìƒ `false` ë°˜í™˜ (nullì¸ í´ë” IDëŠ” ì¡´ì¬í•˜ì§€ ì•ŠìŒ)
     - ê²°ê³¼ì ìœ¼ë¡œ ê¶Œí•œ ì²´í¬ ì‹¤íŒ¨ë¡œ 403 ì—ëŸ¬ ë°œìƒ
   
   - í•˜ìœ„ í´ë” ìƒì„± ì‹œ (`parentId != null`):
     - `parentId`ì— ëŒ€í•œ í¸ì§‘ ê¶Œí•œì´ ì—†ìœ¼ë©´ 403 ì—ëŸ¬ ë°œìƒ
     - ë˜ëŠ” í•´ë‹¹ `parentId`ì˜ í´ë”ê°€ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ ê¶Œí•œ ì²´í¬ ì‹¤íŒ¨ ê°€ëŠ¥

 4. ì°¾ì•„ë³¸ ì—ëŸ¬ í•´ê²°ë°©ì•ˆ
- FilesystemService.createFolder ë©”ì„œë“œ (42ë²ˆ ì¤„) ì—ì„œ `parentId`ì— ëŒ€í•œ í¸ì§‘ ê¶Œí•œì„ ì²´í¬í•©ë‹ˆë‹¤.
```java
  @PreAuthorize("@filesystemSecurity.canEdit(#parentId, #userId)")
   public void createFolder(Long userId, Long parentId, String name)
 ```

5. ê²°ê³¼ 
	- ìš”ì²­ì„ ë³´ë‚¼ ë•Œ í”„ë¡ íŠ¸ ìª½ì—ì„œ ê²°êµ­ 0 ê³¼ nullì„ ê³„ì† ë³´ë‚´ì„œ ìƒê¸°ëŠ” ì˜¤ë¥˜ì˜€ë‹¤. ë°±ì—”ë“œë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •í•˜ê³ , í”„ë¡ íŠ¸ë¥¼ 0-> 1ë¶€í„° ë¬´ì¡°ê±´ ì‹œì‘í•˜ê²Œ í•˜ì—¬ í•´ê²°í–ˆë‹¤. 
```JAVA
package com.ssafy.meethub.common.security;

  

import com.ssafy.meethub.report.repository.ReportRepository;

import com.ssafy.meethub.user.repository.FolderRepository;

import com.ssafy.meethub.user.repository.FolderShareRepository;

import java.util.List;

import lombok.RequiredArgsConstructor;

import lombok.extern.slf4j.Slf4j;

import org.springframework.stereotype.Component;

  

@Component("filesystemSecurity")

@RequiredArgsConstructor

@Slf4j

public class FilesystemSecurity {

Â  Â  private final FolderRepository folderRepository;

Â  Â  private final FolderShareRepository folderShareRepository;

Â  Â  private final ReportRepository reportRepository;

  

Â  Â  public boolean canAccess(Long folderId, Long userId) {

Â  Â  Â  Â  return isOwner(folderId, userId)

Â  Â  Â  Â  Â  Â  Â  Â  || folderShareRepository.countCanAccess(folderId, userId) > 0;

Â  Â  }

  

Â  Â  public boolean canEdit(Long folderId, Long userId) {

Â  Â  Â  Â  // ë£¨íŠ¸ í´ë” ìƒì„±(parentId == null ë˜ëŠ” 0)ì¸ ê²½ìš°, í•­ìƒ í—ˆìš© (ìì‹ ì˜ í´ë”ë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì´ë¯€ë¡œ)

Â  Â  Â  Â  if (folderId == null || folderId == 0) {

Â  Â  Â  Â  Â  Â  log.debug("canEdit: folderId is {} (null/root), allowing root folder creation for userId={}", folderId, userId);

Â  Â  Â  Â  Â  Â  return true;

Â  Â  Â  Â  }

Â  Â  Â  Â  boolean owner = isOwner(folderId, userId);

Â  Â  Â  Â  Long shareCount = folderShareRepository.countCanEdit(folderId, userId);

Â  Â  Â  Â  boolean hasPermission = owner || shareCount > 0;

Â  Â  Â  Â  log.debug("canEdit: folderId={}, userId={}, isOwner={}, shareCount={}, result={}",

Â  Â  Â  Â  Â  Â  Â  Â  folderId, userId, owner, shareCount, hasPermission);

Â  Â  Â  Â  return hasPermission;

Â  Â  }

  

Â  Â  public boolean canDelete(Long folderId, Long userId) {

Â  Â  Â  Â  return isOwner(folderId, userId);

Â  Â  }

  

Â  Â  public boolean canRelocate(List<Long> folderIds, List<Long> fileIds, Long userId) {

Â  Â  Â  Â  // í´ë” ê¶Œí•œ ì²´í¬ - ê° í´ë”ì— ëŒ€í•´ ì†Œìœ ìì´ê±°ë‚˜ ìƒìœ„ í´ë”ì˜ EDITOR ê¶Œí•œ í¬í•¨í•˜ì—¬ í™•ì¸

Â  Â  Â  Â  if (folderIds != null && !folderIds.isEmpty()) {

Â  Â  Â  Â  Â  Â  Long countWithPermission = folderShareRepository.countFoldersWithEditPermission(folderIds, userId);

Â  Â  Â  Â  Â  Â  if (countWithPermission < folderIds.size()) {

Â  Â  Â  Â  Â  Â  Â  Â  return false;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }

  

Â  Â  Â  Â  // íŒŒì¼ ê¶Œí•œ ì²´í¬ - ê° íŒŒì¼ì— ëŒ€í•´ ì†Œìœ ì, ReportShare EDITOR ê¶Œí•œ, ë˜ëŠ” í´ë”ì˜ EDITOR ê¶Œí•œ í™•ì¸

Â  Â  Â  Â  if (fileIds != null && !fileIds.isEmpty()) {

Â  Â  Â  Â  Â  Â  Long countWithPermission = reportRepository.countFilesWithEditPermission(fileIds, userId);

Â  Â  Â  Â  Â  Â  if (countWithPermission < fileIds.size()) {

Â  Â  Â  Â  Â  Â  Â  Â  return false;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }

  

Â  Â  Â  Â  return true;

Â  Â  }

  

Â  Â  private boolean isOwner(Long folderId, Long userId) {

Â  Â  Â  Â  boolean result = folderRepository.existsByIdAndUserIdAndIsDeletedFalse(folderId, userId);

Â  Â  Â  Â  log.debug("isOwner: folderId={}, userId={}, result={}", folderId, userId, result);

Â  Â  Â  Â  return result;

Â  Â  }

}
```

ì§€ë¼ ë§í¬ 
https://ssafy.atlassian.net/browse/S13P31S103-48
